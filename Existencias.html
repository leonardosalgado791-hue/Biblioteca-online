<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Existencias de Libros</title>

    <style>
        body {
            background-color: #3A001E;
            font-family: Arial;
            color: white;
            margin: 0;
            padding: 0;
        }

        h1 {
            text-align: center;
            padding: 20px;
            background-color: #5A002F;
            margin: 0;
        }

        table {
            width: 90%;
            margin: 20px auto;
            border-collapse: collapse;
            background: #ffffffdd;
            color: black;
            border-radius: 10px;
            overflow: hidden;
        }

        th {
            background-color: #5A002F;
            padding: 12px;
            color: white;
        }

        td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #ccc;
        }

        .muchos {
            background-color: #C8E6C9;
        }

        .normales {
            background-color: #FFF9C4;
        }

        .pocos {
            background-color: #FFCDD2;
        }

        .btn {
            background-color: #5A002F;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            border: none;
        }

        .btn:hover {
            background-color: #7A0040;
        }

        .contenedor-btn {
            width: 100%;
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>

<body>

<h1>Existencias de Libros</h1>

<div class="contenedor-btn">
    <a class="btn" href="Administrador.html">⬅ Regresar al Administrador</a>
</div>

<table id="tablaExistencias">
    <tr>
        <th>Libro</th>
        <th>Autor</th>
        <th>Existencias</th>
        <th>Estado</th>
        <th>Acción</th>
    </tr>
</table>

<script>

    function cargarLibros() {
        let librosGuardados = JSON.parse(localStorage.getItem("libros")) || [];

        // Asignar existencias por defecto a los libros que no tengan
        librosGuardados = librosGuardados.map(l => {
            if (l.existencias === undefined) {
                l.existencias = 5; // por defecto
            }
            return l;
        });

        localStorage.setItem("libros", JSON.stringify(librosGuardados));
        return librosGuardados;
    }

    let libros = cargarLibros();

    function mostrarExistencias() {
        const tabla = document.getElementById("tablaExistencias");

        tabla.innerHTML = `
            <tr>
                <th>Libro</th>
                <th>Autor</th>
                <th>Existencias</th>
                <th>Estado</th>
                <th>Acción</th>
            </tr>
        `;

        libros.forEach((libro, index) => {
            let clase = "";
            let estadoTexto = "";

            if (libro.existencias >= 10) {
                clase = "muchos";
                estadoTexto = "Muchos en existencia";
            } else if (libro.existencias >= 4) {
                clase = "normales";
                estadoTexto = "Existencias normales";
            } else {
                clase = "pocos";
                estadoTexto = "Pocas existencias";
            }

            tabla.innerHTML += `
                <tr class="${clase}">
                    <td>${libro.nombre}</td>
                    <td>${libro.autor}</td>
                    <td>${libro.existencias}</td>
                    <td>${estadoTexto}</td>
                    <td>
                        <button class="btn" onclick="agregarExistencia(${index})">Pedir más</button>
                    </td>
                </tr>
            `;
        });
    }

    function agregarExistencia(index) {
        libros[index].existencias++;
        localStorage.setItem("libros", JSON.stringify(libros));
        mostrarExistencias();
        alert("Se agregó 1 existencia al libro: " + libros[index].nombre);
    }

    mostrarExistencias();

    setInterval(() => {
        libros = cargarLibros();
        mostrarExistencias();
    }, 3000);
</script>

</body>
</html>
