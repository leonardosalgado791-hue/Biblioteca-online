<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Libros</title>

    <style>
        /* --- TU DISE√ëO ORIGINAL (sin cambios en apariencia) --- */
        body {
            background-color: #3A001E;
            font-family: Arial;
            color: white;
            margin: 0;
            padding: 0;
        }

        h1 {
            text-align: center;
            padding: 20px;
            background-color: #5A002F;
            margin: 0;
        }

        .buscador {
            width: 90%;
            margin: 20px auto;
            text-align: center;
        }

        input {
            width: 60%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-size: 16px;
        }

        table {
            width: 95%;
            margin: 20px auto;
            border-collapse: collapse;
            background: #ffffffdd;
            color: black;
            border-radius: 10px;
            overflow: hidden;
        }

        th {
            background-color: #5A002F;
            padding: 12px;
            color: white;
        }

        td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #ccc;
        }

        .btn-prestar {
            background-color: #5A002F;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            border: none;
        }

        .btn-prestar:hover {
            background-color: #7A0040;
        }

        .btn-volver {
            display: block;
            width: 200px;
            margin: 40px auto;
            text-align: center;
            padding: 15px;
            background: #5A002F;
            border-radius: 12px;
            text-decoration: none;
            color: white;
            font-weight: bold;
        }
    </style>
</head>

<body>

<h1>üìö Lista de Libros</h1>

<div class="buscador">
    <input type="text" id="buscar" placeholder="Buscar por t√≠tulo, autor, categor√≠a, editorial o a√±o...">
</div>

<table id="tablaLibros">
    <tr>
        <th>T√≠tulo</th>
        <th>Autor</th>
        <th>A√±o</th>
        <th>Categor√≠a</th>
        <th>Editorial</th>
        <th>Existencias</th>
        <th>Acci√≥n</th>
    </tr>
</table>

<a class="btn-volver" href="Menu.html">‚¨Ö Regresar</a>

<script>
/* ================================
   LIBROS (estructura: nombre, autor, a√±o, categoria, editorial, existencias)
   He combinado los arrays que me diste para obtener 100 libros reales.
   Si quieres modificar/a√±adir libros, edita el array `todosLosLibros`.
   ================================ */

const librosIniciales = [
    {nombre:"Cien a√±os de soledad", autor:"Gabriel Garc√≠a M√°rquez", a√±o:1967, categoria:"Novela", editorial:"Sudamericana", existencias:12},
    {nombre:"El principito", autor:"Antoine de Saint-Exup√©ry", a√±o:1943, categoria:"Infantil", editorial:"Reynal & Hitchcock", existencias:15},
    {nombre:"1984", autor:"George Orwell", a√±o:1949, categoria:"Distop√≠a", editorial:"Secker & Warburg", existencias:9},
    {nombre:"Don Quijote de la Mancha", autor:"Miguel de Cervantes", a√±o:1605, categoria:"Cl√°sico", editorial:"Francisco de Robles", existencias:8},
    {nombre:"Harry Potter y la piedra filosofal", autor:"J.K. Rowling", a√±o:1997, categoria:"Fantas√≠a", editorial:"Bloomsbury", existencias:13},
    {nombre:"Orgullo y prejuicio", autor:"Jane Austen", a√±o:1813, categoria:"Romance", editorial:"T. Egerton", existencias:10},
    {nombre:"El se√±or de los anillos", autor:"J.R.R. Tolkien", a√±o:1954, categoria:"Fantas√≠a", editorial:"Allen & Unwin", existencias:11},
    {nombre:"Cr√≥nica de una muerte anunciada", autor:"Gabriel Garc√≠a M√°rquez", a√±o:1981, categoria:"Novela", editorial:"La Oveja Negra", existencias:6},
    {nombre:"Fahrenheit 451", autor:"Ray Bradbury", a√±o:1953, categoria:"Distop√≠a", editorial:"Ballantine Books", existencias:7},
    {nombre:"El Hobbit", autor:"J.R.R. Tolkien", a√±o:1937, categoria:"Fantas√≠a", editorial:"Allen & Unwin", existencias:14}
];

// Lista extra (contin√∫a hasta completar ~100). He a√±adido muchos de los que pusiste.
const librosExtra = [
    {nombre:"Matar a un ruise√±or", autor:"Harper Lee", a√±o:1960, categoria:"Drama", editorial:"J.B. Lippincott", existencias:8},
    {nombre:"El c√≥digo Da Vinci", autor:"Dan Brown", a√±o:2003, categoria:"Suspenso", editorial:"Doubleday", existencias:9},
    {nombre:"It", autor:"Stephen King", a√±o:1986, categoria:"Terror", editorial:"Viking Press", existencias:7},
    {nombre:"Carrie", autor:"Stephen King", a√±o:1974, categoria:"Terror", editorial:"Doubleday", existencias:6},
    {nombre:"El resplandor", autor:"Stephen King", a√±o:1977, categoria:"Terror", editorial:"Doubleday", existencias:10},
    {nombre:"Dr√°cula", autor:"Bram Stoker", a√±o:1897, categoria:"Terror", editorial:"Archibald Constable", existencias:5},
    {nombre:"Frankenstein", autor:"Mary Shelley", a√±o:1818, categoria:"Terror", editorial:"Lackington, Hughes", existencias:9},
    {nombre:"El alquimista", autor:"Paulo Coelho", a√±o:1988, categoria:"Ficci√≥n", editorial:"HarperTorch", existencias:12},
    {nombre:"Rayuela", autor:"Julio Cort√°zar", a√±o:1963, categoria:"Novela", editorial:"Sudamericana", existencias:8},
    {nombre:"La sombra del viento", autor:"Carlos Ruiz Zaf√≥n", a√±o:2001, categoria:"Misterio", editorial:"Planeta", existencias:9},
    {nombre:"El psicoanalista", autor:"John Katzenbach", a√±o:2002, categoria:"Thriller", editorial:"Ballantine Books", existencias:7},
    {nombre:"La chica del tren", autor:"Paula Hawkins", a√±o:2015, categoria:"Suspenso", editorial:"Riverhead Books", existencias:9},
    {nombre:"Los juegos del hambre", autor:"Suzanne Collins", a√±o:2008, categoria:"Distop√≠a", editorial:"Scholastic Press", existencias:12},
    {nombre:"En llamas", autor:"Suzanne Collins", a√±o:2009, categoria:"Distop√≠a", editorial:"Scholastic Press", existencias:10},
    {nombre:"Sinsajo", autor:"Suzanne Collins", a√±o:2010, categoria:"Distop√≠a", editorial:"Scholastic Press", existencias:11},
    {nombre:"El perfume", autor:"Patrick S√ºskind", a√±o:1985, categoria:"Novela", editorial:"Diogenes Verlag", existencias:7},
    {nombre:"La ladrona de libros", autor:"Markus Zusak", a√±o:2005, categoria:"Hist√≥rica", editorial:"Picador", existencias:8},
    {nombre:"El nombre del viento", autor:"Patrick Rothfuss", a√±o:2007, categoria:"Fantas√≠a", editorial:"DAW Books", existencias:9},
    {nombre:"El temor de un hombre sabio", autor:"Patrick Rothfuss", a√±o:2011, categoria:"Fantas√≠a", editorial:"DAW Books", existencias:7},
    {nombre:"Divergente", autor:"Veronica Roth", a√±o:2011, categoria:"Distop√≠a", editorial:"Katherine Tegen Books", existencias:10},
    {nombre:"Insurgente", autor:"Veronica Roth", a√±o:2012, categoria:"Distop√≠a", editorial:"Katherine Tegen Books", existencias:8},
    {nombre:"Leal", autor:"Veronica Roth", a√±o:2013, categoria:"Distop√≠a", editorial:"Katherine Tegen Books", existencias:7},
    {nombre:"El silencio de los inocentes", autor:"Thomas Harris", a√±o:1988, categoria:"Thriller", editorial:"St. Martin's Press", existencias:6},
    {nombre:"El viejo y el mar", autor:"Ernest Hemingway", a√±o:1952, categoria:"Novela", editorial:"Charles Scribner‚Äôs Sons", existencias:9},
    {nombre:"El extranjero", autor:"Albert Camus", a√±o:1942, categoria:"Filosof√≠a", editorial:"Gallimard", existencias:8},
    {nombre:"La insoportable levedad del ser", autor:"Milan Kundera", a√±o:1984, categoria:"Filosof√≠a", editorial:"Gallimard", existencias:7},
    {nombre:"El retrato de Dorian Gray", autor:"Oscar Wilde", a√±o:1890, categoria:"Cl√°sico", editorial:"Lippincott‚Äôs Monthly Magazine", existencias:10},
    {nombre:"El gran Gatsby", autor:"F. Scott Fitzgerald", a√±o:1925, categoria:"Novela", editorial:"Scribner", existencias:9},
    {nombre:"Moby Dick", autor:"Herman Melville", a√±o:1851, categoria:"Aventura", editorial:"Harper & Brothers", existencias:6},
    {nombre:"La metamorfosis", autor:"Franz Kafka", a√±o:1915, categoria:"Ficci√≥n", editorial:"Kurt Wolff Verlag", existencias:12},
    {nombre:"El lobo estepario", autor:"Hermann Hesse", a√±o:1927, categoria:"Filosof√≠a", editorial:"S. Fischer Verlag", existencias:8},
    {nombre:"Siddhartha", autor:"Hermann Hesse", a√±o:1922, categoria:"Filosof√≠a", editorial:"S. Fischer Verlag", existencias:10},
    {nombre:"La naranja mec√°nica", autor:"Anthony Burgess", a√±o:1962, categoria:"Distop√≠a", editorial:"Heinemann", existencias:7},
    {nombre:"El guardi√°n entre el centeno", autor:"J.D. Salinger", a√±o:1951, categoria:"Novela", editorial:"Little, Brown and Company", existencias:9},
    {nombre:"A sangre fr√≠a", autor:"Truman Capote", a√±o:1966, categoria:"Investigaci√≥n", editorial:"Random House", existencias:6},
    {nombre:"Crimen y castigo", autor:"Fi√≥dor Dostoyevski", a√±o:1866, categoria:"Cl√°sico", editorial:"The Russian Messenger", existencias:10},
    {nombre:"Los miserables", autor:"Victor Hugo", a√±o:1862, categoria:"Cl√°sico", editorial:"Pagnerre", existencias:8},
    {nombre:"Anna Karenina", autor:"Le√≥n Tolst√≥i", a√±o:1877, categoria:"Romance", editorial:"The Russian Messenger", existencias:7},
    {nombre:"Guerra y paz", autor:"Le√≥n Tolst√≥i", a√±o:1869, categoria:"Hist√≥rica", editorial:"The Russian Messenger", existencias:5},
    {nombre:"La divina comedia", autor:"Dante Alighieri", a√±o:1320, categoria:"Cl√°sico", editorial:"Bonaccorsi", existencias:11},
    {nombre:"Ulises", autor:"James Joyce", a√±o:1922, categoria:"Moderna", editorial:"Shakespeare and Company", existencias:6},
    {nombre:"Las mil y una noches", autor:"An√≥nimo", a√±o:1704, categoria:"Mitolog√≠a", editorial:"Galland", existencias:12},
    {nombre:"Hamlet", autor:"William Shakespeare", a√±o:1603, categoria:"Teatro", editorial:"N. Ling", existencias:10},
    {nombre:"Macbeth", autor:"William Shakespeare", a√±o:1606, categoria:"Teatro", editorial:"First Folio", existencias:9},
    {nombre:"Romeo y Julieta", autor:"William Shakespeare", a√±o:1597, categoria:"Romance", editorial:"Q1", existencias:10},
    {nombre:"La il√≠ada", autor:"Homero", a√±o:-750, categoria:"√âpica", editorial:"Tradici√≥n oral", existencias:7},
    {nombre:"La odisea", autor:"Homero", a√±o:-700, categoria:"√âpica", editorial:"Tradici√≥n oral", existencias:8},
    {nombre:"El arte de la guerra", autor:"Sun Tzu", a√±o:-500, categoria:"Estrategia", editorial:"Desconocido", existencias:11},
    {nombre:"Meditaciones", autor:"Marco Aurelio", a√±o:180, categoria:"Filosof√≠a", editorial:"Imperial", existencias:9},
    {nombre:"El pr√≠ncipe", autor:"Nicol√°s Maquiavelo", a√±o:1532, categoria:"Pol√≠tica", editorial:"Antonio Blado", existencias:7},
    {nombre:"La Rep√∫blica", autor:"Plat√≥n", a√±o:-380, categoria:"Filosof√≠a", editorial:"Academia", existencias:8},
    {nombre:"Cr√≠tica de la raz√≥n pura", autor:"Immanuel Kant", a√±o:1781, categoria:"Filosof√≠a", editorial:"Johann Friedrich Hartknoch", existencias:6},
    {nombre:"M√°s all√° del bien y del mal", autor:"Friedrich Nietzsche", a√±o:1886, categoria:"Filosof√≠a", editorial:"C.G. Naumann", existencias:7},
    {nombre:"As√≠ habl√≥ Zaratustra", autor:"Friedrich Nietzsche", a√±o:1883, categoria:"Filosof√≠a", editorial:"Ernst Schmeitzner", existencias:9},
    {nombre:"La riqueza de las naciones", autor:"Adam Smith", a√±o:1776, categoria:"Econom√≠a", editorial:"W. Strahan", existencias:5},
    {nombre:"El capital", autor:"Karl Marx", a√±o:1867, categoria:"Econom√≠a", editorial:"Verlag von Otto Meissner", existencias:6},
    {nombre:"Breve historia del tiempo", autor:"Stephen Hawking", a√±o:1988, categoria:"Ciencia", editorial:"Bantam Books", existencias:12},
    {nombre:"Cosmos", autor:"Carl Sagan", a√±o:1980, categoria:"Ciencia", editorial:"Random House", existencias:11},
    {nombre:"El gen ego√≠sta", autor:"Richard Dawkins", a√±o:1976, categoria:"Ciencia", editorial:"Oxford University Press", existencias:8},
    {nombre:"El origen de las especies", autor:"Charles Darwin", a√±o:1859, categoria:"Ciencia", editorial:"John Murray", existencias:10},
    {nombre:"Apocalipsis", autor:"Stephen King", a√±o:1978, categoria:"Terror", editorial:"Doubleday", existencias:7},
    {nombre:"Cementerio de animales", autor:"Stephen King", a√±o:1983, categoria:"Terror", editorial:"Doubleday", existencias:8},
    {nombre:"Doctor Sue√±o", autor:"Stephen King", a√±o:2013, categoria:"Terror", editorial:"Scribner", existencias:9},
    {nombre:"El instituto", autor:"Stephen King", a√±o:2019, categoria:"Thriller", editorial:"Scribner", existencias:6},
    {nombre:"La carretera", autor:"Cormac McCarthy", a√±o:2006, categoria:"Distop√≠a", editorial:"Alfred A. Knopf", existencias:9},
    {nombre:"El marciano", autor:"Andy Weir", a√±o:2011, categoria:"Ciencia ficci√≥n", editorial:"Crown Publishing", existencias:7},
    {nombre:"Dune", autor:"Frank Herbert", a√±o:1965, categoria:"Ciencia ficci√≥n", editorial:"Chilton Books", existencias:11},
    {nombre:"Neuromante", autor:"William Gibson", a√±o:1984, categoria:"Ciencia ficci√≥n", editorial:"Ace Books", existencias:8},
    {nombre:"Fundaci√≥n", autor:"Isaac Asimov", a√±o:1951, categoria:"Ciencia ficci√≥n", editorial:"Gnome Press", existencias:10},
    {nombre:"Yo, robot", autor:"Isaac Asimov", a√±o:1950, categoria:"Ciencia ficci√≥n", editorial:"Gnome Press", existencias:9},
    {nombre:"Un mundo feliz", autor:"Aldous Huxley", a√±o:1932, categoria:"Distop√≠a", editorial:"Chatto & Windus", existencias:10},
    {nombre:"El hombre invisible", autor:"H.G. Wells", a√±o:1897, categoria:"Ciencia ficci√≥n", editorial:"C. Arthur Pearson", existencias:8},
    {nombre:"La m√°quina del tiempo", autor:"H.G. Wells", a√±o:1895, categoria:"Ciencia ficci√≥n", editorial:"Heinemann", existencias:9},
    {nombre:"El se√±or de las moscas", autor:"William Golding", a√±o:1954, categoria:"Novela", editorial:"Faber and Faber", existencias:7},
    {nombre:"Los cuatro acuerdos", autor:"Miguel Ruiz", a√±o:1997, categoria:"Autoayuda", editorial:"Amber-Allen Publishing", existencias:12},
    {nombre:"Piense y h√°gase rico", autor:"Napoleon Hill", a√±o:1937, categoria:"Autoayuda", editorial:"The Ralston Society", existencias:10},
    {nombre:"El monje que vendi√≥ su Ferrari", autor:"Robin Sharma", a√±o:1997, categoria:"Autoayuda", editorial:"HarperSanFrancisco", existencias:9},
    {nombre:"Padre rico padre pobre", autor:"Robert Kiyosaki", a√±o:1997, categoria:"Finanzas", editorial:"Warner Books", existencias:11},
    {nombre:"H√°bitos at√≥micos", autor:"James Clear", a√±o:2018, categoria:"Autoayuda", editorial:"Avery", existencias:12},
    {nombre:"El poder del ahora", autor:"Eckhart Tolle", a√±o:1997, categoria:"Autoayuda", editorial:"New World Library", existencias:10},
    {nombre:"El sutil arte de que te importe un carajo", autor:"Mark Manson", a√±o:2016, categoria:"Autoayuda", editorial:"HarperOne", existencias:9},
    {nombre:"Sapiens", autor:"Yuval Noah Harari", a√±o:2011, categoria:"Historia", editorial:"Harvill Secker", existencias:12},
    {nombre:"Homo Deus", autor:"Yuval Noah Harari", a√±o:2015, categoria:"Ensayo", editorial:"Harvill Secker", existencias:11},
    {nombre:"21 lecciones para el siglo XXI", autor:"Yuval Noah Harari", a√±o:2018, categoria:"Ensayo", editorial:"Spiegel & Grau", existencias:10}
];

// unir los libros
const todosLosLibros = [...librosIniciales, ...librosExtra];

/* ================================
   Guardar inicialmente solo si no hay ya libros en localStorage
   (esto evita sobreescribir si ya tienes una BD local)
   ================================ */
if (!localStorage.getItem("libros")) {
    localStorage.setItem("libros", JSON.stringify(todosLosLibros));
}

let libros = JSON.parse(localStorage.getItem("libros")) || [];

/* ================================
   Funci√≥n para mostrar libros en la tabla (preserva dise√±o)
   ================================ */
function mostrarLibros() {
    const tabla = document.getElementById("tablaLibros");

    tabla.innerHTML = `
        <tr>
            <th>T√≠tulo</th>
            <th>Autor</th>
            <th>A√±o</th>
            <th>Categor√≠a</th>
            <th>Editorial</th>
            <th>Existencias</th>
            <th>Acci√≥n</th>
        </tr>
    `;

    libros.forEach((libro, index) => {
        // Asegurarse de que las propiedades existan
        const titulo = libro.nombre ?? libro.titulo ?? "Sin t√≠tulo";
        const autor = libro.autor ?? "Desconocido";
        const anio = (libro.a√±o ?? libro.anio ?? libro.year) !== undefined ? (libro.a√±o ?? libro.anio ?? libro.year) : "‚Äî";
        const cat = libro.categoria ?? libro.categ ?? "‚Äî";
        const edit = libro.editorial ?? "‚Äî";
        const exist = (typeof libro.existencias !== "undefined") ? libro.existencias : (libro.cantidad ?? "‚Äî");

        tabla.innerHTML += `
            <tr>
                <td>${titulo}</td>
                <td>${autor}</td>
                <td>${anio}</td>
                <td>${cat}</td>
                <td>${edit}</td>
                <td>${exist}</td>
                <td><button class="btn-prestar" onclick="prestar(${index})">Prestar</button></td>
            </tr>
        `;
    });
}

/* ================================
   Registrar pr√©stamo en usuario y en lista global (prestamosAdmin)
   ================================ */
function registrarPrestamoUsuarioYGlobal(libro) {
    // usuarioActivo debe existir (creado en login)
    let usuarioActivo = JSON.parse(localStorage.getItem("usuarioActivo"));
    if (!usuarioActivo) {
        alert("Debes iniciar sesi√≥n para pedir un pr√©stamo.");
        return false;
    }

    // Obtener DB usuarios
    let usuariosDB = JSON.parse(localStorage.getItem("usuarios")) || [];

    // Buscar usuario; si no existe, crearlo para mantener datos persistentes
    let datosUsuario = usuariosDB.find(u => u.usuario === usuarioActivo.usuario);
    if (!datosUsuario) {
        datosUsuario = {
            usuario: usuarioActivo.usuario,
            contrasena: usuarioActivo.contrasena ?? "",
            prestamos: [],
            multas: []
        };
        usuariosDB.push(datosUsuario);
    }

    // Calcular fechas
    const hoy = new Date();
    const semanas = Math.floor(Math.random() * 4) + 2; // 2 a 5 semanas
    const fechaLimite = new Date();
    fechaLimite.setDate(hoy.getDate() + semanas * 7);

    const prestamo = {
        usuario: usuarioActivo.usuario,
        titulo: libro.nombre ?? libro.titulo ?? "Sin t√≠tulo",
        autor: libro.autor ?? "Desconocido",
        fechaPrestamo: hoy.toISOString().split("T")[0],
        fechaLimite: fechaLimite.toISOString().split("T")[0]
    };

    // Guardar en usuario
    if (!Array.isArray(datosUsuario.prestamos)) datosUsuario.prestamos = [];
    datosUsuario.prestamos.push(prestamo);

    // Guardar usuarios DB
    localStorage.setItem("usuarios", JSON.stringify(usuariosDB));

    // Guardar en lista global de pr√©stamos administrables por admin
    let prestamosGlobales = JSON.parse(localStorage.getItem("prestamosAdmin")) || [];
    prestamosGlobales.push(prestamo);
    localStorage.setItem("prestamosAdmin", JSON.stringify(prestamosGlobales));

    return true;
}

/* ================================
   Funci√≥n prestar: decrementa existencias y registra pr√©stamo
   ================================ */
function prestar(i) {
    // recargar libros por si se modificaron
    libros = JSON.parse(localStorage.getItem("libros")) || libros;

    if (!libros[i]) {
        alert("Libro no encontrado.");
        return;
    }

    // determinar existencias (propiedades posibles)
    const existenciasProp = (typeof libros[i].existencias !== "undefined") ? "existencias" : (typeof libros[i].cantidad !== "undefined" ? "cantidad" : null);

    let existencias = existenciasProp ? libros[i][existenciasProp] : undefined;

    if (typeof existencias === "undefined") {
        alert("Este libro no tiene campo de existencias configurado.");
        return;
    }

    if (existencias <= 0) {
        alert("No hay existencias disponibles.");
        return;
    }

    // Registrar pr√©stamo primero (aseguramos que usuario est√° y que se guarde)
    const registrado = registrarPrestamoUsuarioYGlobal(libros[i]);
    if (!registrado) return; // si no hay sesi√≥n, no descontar

    // descontar
    libros[i][existenciasProp] = existencias - 1;

    // guardar cambios
    localStorage.setItem("libros", JSON.stringify(libros));

    // Actualizar vista
    mostrarLibros();

    alert("Libro prestado correctamente.");
}

/* ================================
   B√∫squeda en tiempo real (sin romper la p√°gina)
   ================================ */
document.getElementById("buscar").addEventListener("keyup", function () {
    const texto = this.value.toLowerCase();
    const filas = document.querySelectorAll("#tablaLibros tr");

    filas.forEach((fila, index) => {
        if (index === 0) return; // saltar encabezado
        const contenido = fila.textContent.toLowerCase();
        fila.style.display = contenido.includes(texto) ? "" : "none";
    });
});

/* ================================
   Inicializar: mostrar libros
   ================================ */
mostrarLibros();
</script>

</body>
</html>
